# Agent Service

ResearchGO AI ç ”ç©¶åŠ©æ‰‹ Agent æœåŠ¡ï¼ŒåŸºäº LangGraph å®ç°ã€‚

## åŠŸèƒ½

- ğŸ¤– **æ™ºèƒ½å¯¹è¯**: ç†è§£ç”¨æˆ·æ„å›¾ï¼Œè‡ªåŠ¨è§„åˆ’å’Œæ‰§è¡Œä»»åŠ¡
- ğŸ”§ **å·¥å…·è°ƒç”¨**: è‡ªåŠ¨è°ƒç”¨å„å¾®æœåŠ¡å®Œæˆç ”ç©¶ä»»åŠ¡
- ğŸ“¡ **æµå¼å“åº”**: SSE å®æ—¶è¿”å›æ€è€ƒè¿‡ç¨‹å’Œç»“æœ
- ğŸ§  **ä¸Šä¸‹æ–‡è®°å¿†**: æ”¯æŒå¤šè½®å¯¹è¯ä¸Šä¸‹æ–‡

## å¯ç”¨å·¥å…·

| å·¥å…· | æè¿° | å¯¹åº”æœåŠ¡ |
|------|------|----------|
| search_literature | æœç´¢å­¦æœ¯æ–‡çŒ® | literature-service |
| get_work_detail | è·å–è®ºæ–‡è¯¦æƒ… | literature-service |
| get_related_works | è·å–ç›¸å…³è®ºæ–‡ | literature-service |
| export_citation | å¯¼å‡ºå¼•ç”¨æ ¼å¼ | literature-service |
| search_user_papers | æœç´¢ç”¨æˆ·è®ºæ–‡ | paper-storage-service |
| get_paper_content | è·å–è®ºæ–‡å†…å®¹ | paper-storage-service |
| semantic_search | è¯­ä¹‰æœç´¢ | vector-search-service |
| ask_about_paper | è®ºæ–‡é—®ç­” | vector-search-service |
| analyze_paper | åˆ†æè®ºæ–‡ | analysis-service |
| generate_mindmap | ç”Ÿæˆæ€ç»´å¯¼å›¾ | mindmap-service |
| compare_papers | å¯¹æ¯”è®ºæ–‡ | analysis-service |

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
cd backend/services/agent-service

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv .venv
.venv\Scripts\activate  # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. é…ç½®ç¯å¢ƒå˜é‡ï¼ˆåˆ›å»º .env æ–‡ä»¶ï¼‰

# 5. å¯åŠ¨æœåŠ¡
python run.py
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### 2. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# OpenAI
OPENAI_API_KEY=your-api-key
OPENAI_MODEL=gpt-4o
OPENAI_BASE_URL=  # å¯é€‰ï¼Œè‡ªå®šä¹‰ API åœ°å€

# JWT
SECRET_KEY=your-secret-key

# å¾®æœåŠ¡åœ°å€
AUTH_SERVICE_URL=http://localhost:8001
CONVERSATION_SERVICE_URL=http://localhost:8002
PAPER_STORAGE_SERVICE_URL=http://localhost:8003
VECTOR_SEARCH_SERVICE_URL=http://localhost:8004
LITERATURE_SERVICE_URL=http://localhost:8005
CHAT_SERVICE_URL=http://localhost:8006
MINDMAP_SERVICE_URL=http://localhost:8007
ANALYSIS_SERVICE_URL=http://localhost:8008

# Agent é…ç½®
MAX_ITERATIONS=10
AGENT_TIMEOUT=120
```

### 3. å¯åŠ¨æœåŠ¡

```bash
python run.py
```

æœåŠ¡å°†åœ¨ http://localhost:8000 å¯åŠ¨

## API ç«¯ç‚¹

### POST /api/agent/chat

Agent å¯¹è¯æ¥å£

**è¯·æ±‚ä½“**:
```json
{
  "message": "å¸®æˆ‘æ‰¾å‡ ç¯‡å…³äº Transformer çš„è®ºæ–‡",
  "stream": true
}
```

**æµå¼å“åº”** (SSE):
```
event: thinking
data: "ğŸ”§ å‡†å¤‡è°ƒç”¨å·¥å…·: search_literature"

event: tool_call
data: {"name": "search_literature", "arguments": {"query": "Transformer"}}

event: answer
data: "æ‰¾åˆ°ä»¥ä¸‹å…³äº Transformer çš„è®ºæ–‡..."

event: done
data: null
```

### GET /api/agent/tools

è·å–æ‰€æœ‰å¯ç”¨å·¥å…·åˆ—è¡¨

### POST /api/agent/tools/{tool_name}/execute

ç›´æ¥æ‰§è¡ŒæŒ‡å®šå·¥å…·ï¼ˆè°ƒè¯•ç”¨ï¼‰

### GET /api/agent/health

å¥åº·æ£€æŸ¥

## æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Agent Service                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              LangGraph Agent                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚    â”‚
â”‚  â”‚  â”‚ Reason  â”‚â†’ â”‚ Execute â”‚â†’ â”‚ Respond â”‚         â”‚    â”‚
â”‚  â”‚  â”‚  Node   â”‚  â”‚  Tools  â”‚  â”‚  Node   â”‚         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                          â”‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              MCP Tools Registry                  â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚Search  â”‚ â”‚ Paper  â”‚ â”‚ Vector â”‚ â”‚Analysisâ”‚   â”‚    â”‚
â”‚  â”‚  â”‚  Lit   â”‚ â”‚Storage â”‚ â”‚ Search â”‚ â”‚  Tools â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚           Microservices               â”‚
        â”‚  8001  8002  8003  8004  8005  ...    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ç›®å½•ç»“æ„

```
agent-service/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # FastAPI å…¥å£
â”‚   â”œâ”€â”€ config.py            # é…ç½®
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ agent.py         # API ç«¯ç‚¹
â”‚   â”œâ”€â”€ agent/
â”‚   â”‚   â””â”€â”€ graph.py         # LangGraph Agent
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ state.py         # çŠ¶æ€å®šä¹‰
â”‚   â”œâ”€â”€ tools/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py          # å·¥å…·åŸºç±»
â”‚   â”‚   â”œâ”€â”€ registry.py      # å·¥å…·æ³¨å†Œä¸­å¿ƒ
â”‚   â”‚   â”œâ”€â”€ literature_tools.py
â”‚   â”‚   â”œâ”€â”€ paper_tools.py
â”‚   â”‚   â”œâ”€â”€ vector_tools.py
â”‚   â”‚   â””â”€â”€ analysis_tools.py
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ auth.py          # è®¤è¯å·¥å…·
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ run.py
â””â”€â”€ README.md
```

