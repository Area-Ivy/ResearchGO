# Milvus å‘é‡æ•°æ®åº“éƒ¨ç½²å®Œæˆ âœ…

## ğŸ‰ å·²å®Œæˆçš„å·¥ä½œ

### 1. Docker Compose é…ç½®
å·²åœ¨ `docker-compose.yml` ä¸­æ·»åŠ ä»¥ä¸‹æœåŠ¡ï¼š

- **etcd** (v3.5.5) - Milvus å…ƒæ•°æ®å­˜å‚¨
- **Milvus** (v2.3.3) - å‘é‡æ•°æ®åº“æ ¸å¿ƒæœåŠ¡
- **Attu** (v2.3.4) - å¯è§†åŒ–ç®¡ç†ç•Œé¢

### 2. Python æœåŠ¡å°è£…
åˆ›å»ºäº† `backend/app/services/milvus_service.py`ï¼Œæä¾›ï¼š

- âœ… è¿æ¥ç®¡ç†
- âœ… é›†åˆåˆ›å»ºå’Œç®¡ç†
- âœ… ç´¢å¼•åˆ›å»º
- âœ… å‘é‡æ’å…¥
- âœ… ç›¸ä¼¼åº¦æœç´¢
- âœ… æ•°æ®åˆ é™¤
- âœ… ç»Ÿè®¡ä¿¡æ¯æŸ¥è¯¢

### 3. ä¾èµ–ç®¡ç†
æ›´æ–°äº† `backend/requirements.txt`ï¼Œæ·»åŠ ï¼š

- `pymilvus==2.3.3` - Milvus Python SDK
- `loguru==0.7.2` - æ—¥å¿—ç®¡ç†

### 4. ç¤ºä¾‹ä»£ç 
åˆ›å»ºäº† `backend/examples/milvus_example.py`ï¼Œæ¼”ç¤ºå®Œæ•´ä½¿ç”¨æµç¨‹

### 5. æ–‡æ¡£
åˆ›å»ºäº†å®Œæ•´çš„æ–‡æ¡£ä½“ç³»ï¼š

- ğŸ“– `docs/QUICK_START.md` - å¿«é€Ÿå¯åŠ¨æŒ‡å—
- ğŸ“– `docs/MILVUS_SETUP.md` - è¯¦ç»†éƒ¨ç½²å’Œä½¿ç”¨æ–‡æ¡£
- ğŸ“– `docs/ENV_CONFIG.md` - ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Step 1: å¯åŠ¨æœåŠ¡

```bash
docker-compose up -d
```

### Step 2: è®¿é—® Attu å¯è§†åŒ–ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:9002

åœ¨è¿æ¥é¡µé¢è¾“å…¥ï¼š`milvus:19530` æˆ– `localhost:19530`

### Step 3: è¿è¡Œç¤ºä¾‹ç¨‹åº

```bash
cd backend
pip install -r requirements.txt
python examples/milvus_example.py
```

## ğŸ“Š æœåŠ¡ç«¯å£

| æœåŠ¡ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| Milvus | 19530 | gRPC æ•°æ®åº“è¿æ¥ |
| Attu | 9002 | Web å¯è§†åŒ–ç®¡ç† |
| Milvus Metrics | 9091 | Prometheus ç›‘æ§ |
| MinIO | 9000 | å¯¹è±¡å­˜å‚¨ API |
| MinIO Console | 9001 | MinIO ç®¡ç†ç•Œé¢ |

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åœ¨ä½ çš„ä»£ç ä¸­ä½¿ç”¨

```python
from app.services.milvus_service import milvus_service

# è¿æ¥
milvus_service.connect()

# åˆ›å»ºé›†åˆï¼ˆ768ç»´å‘é‡ï¼Œé€‚ç”¨äºå¤§å¤šæ•° BERT æ¨¡å‹ï¼‰
milvus_service.create_collection(dim=768)

# åˆ›å»ºç´¢å¼•
milvus_service.create_index()

# æ’å…¥è®ºæ–‡å‘é‡
milvus_service.insert_vectors(
    paper_ids=["paper_001", "paper_002"],
    embeddings=[
        [0.1, 0.2, ..., 0.768],  # è®ºæ–‡1çš„å‘é‡
        [0.2, 0.3, ..., 0.768]   # è®ºæ–‡2çš„å‘é‡
    ],
    titles=["è®ºæ–‡æ ‡é¢˜1", "è®ºæ–‡æ ‡é¢˜2"],
    abstracts=["æ‘˜è¦1", "æ‘˜è¦2"],
    sources=["abstract", "abstract"]
)

# æœç´¢ç›¸ä¼¼è®ºæ–‡
query_vector = [0.15, 0.25, ..., 0.768]  # æŸ¥è¯¢å‘é‡
results = milvus_service.search_similar(
    query_vectors=[query_vector],
    top_k=10,
    metric_type="L2"  # æˆ– "IP"ã€"COSINE"
)

# å¤„ç†ç»“æœ
for hits in results:
    for hit in hits:
        print(f"è®ºæ–‡ID: {hit['paper_id']}")
        print(f"æ ‡é¢˜: {hit['title']}")
        print(f"ç›¸ä¼¼åº¦: {hit['distance']}")
```

## ğŸ¯ åº”ç”¨åœºæ™¯

### 1. è®ºæ–‡æ£€ç´¢
- æ ¹æ®è®ºæ–‡æ‘˜è¦æŸ¥æ‰¾ç›¸ä¼¼è®ºæ–‡
- åŸºäºå…¨æ–‡å†…å®¹çš„è¯­ä¹‰æœç´¢
- æ¨èç›¸å…³ç ”ç©¶æ–‡çŒ®

### 2. é—®ç­”ç³»ç»Ÿ
- è¯­ä¹‰é—®ç­”åŒ¹é…
- çŸ¥è¯†åº“æ£€ç´¢
- ä¸Šä¸‹æ–‡ç›¸å…³æ¨è

### 3. å†…å®¹æ¨è
- ç›¸ä¼¼å†…å®¹æ¨è
- ä¸ªæ€§åŒ–æ¨è
- è·¨è¯­è¨€æ£€ç´¢

## ğŸ“ æ•°æ®æŒä¹…åŒ–

æ•°æ®å­˜å‚¨åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼š

```
ResearchGO/
â”œâ”€â”€ minio_data/    # MinIO å¯¹è±¡å­˜å‚¨
â”œâ”€â”€ etcd_data/     # etcd å…ƒæ•°æ®
â”œâ”€â”€ milvus_data/   # Milvus å‘é‡æ•°æ®
â””â”€â”€ docker-compose.yml
```

**æ³¨æ„ï¼š** è¿™äº›ç›®å½•å·²è‡ªåŠ¨æ·»åŠ åˆ° `.gitignore`

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f milvus
docker-compose logs -f attu

# é‡å¯æœåŠ¡
docker-compose restart milvus

# åœæ­¢æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼ï¼‰
docker-compose down -v
```

## ğŸ” åœ¨ Attu ä¸­çš„æ“ä½œ

1. **æŸ¥çœ‹é›†åˆ**ï¼šåœ¨å·¦ä¾§å¯¼èˆªæ å¯ä»¥çœ‹åˆ°æ‰€æœ‰é›†åˆ
2. **æµè§ˆæ•°æ®**ï¼šç‚¹å‡»é›†åˆåç§°æŸ¥çœ‹æ•°æ®
3. **æ‰§è¡Œæœç´¢**ï¼šä½¿ç”¨ Search åŠŸèƒ½æµ‹è¯•å‘é‡æœç´¢
4. **ç®¡ç†ç´¢å¼•**ï¼šæŸ¥çœ‹å’Œç®¡ç†ç´¢å¼•é…ç½®
5. **ç›‘æ§æ€§èƒ½**ï¼šæŸ¥çœ‹å®æ—¶æ€§èƒ½æŒ‡æ ‡

## ğŸ“š æŠ€æœ¯æ ˆ

- **Milvus 2.3.3** - å¼€æºå‘é‡æ•°æ®åº“
- **etcd 3.5.5** - åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨
- **MinIO** - å¯¹è±¡å­˜å‚¨ï¼ˆå·²æœ‰ï¼‰
- **Attu 2.3.4** - Milvus ç®¡ç†ç•Œé¢
- **PyMilvus 2.3.3** - Python SDK

## âš¡ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### ç´¢å¼•é€‰æ‹©
- **IVF_FLAT**ï¼šå¹³è¡¡ç²¾åº¦å’Œé€Ÿåº¦ï¼ˆæ¨èå…¥é—¨ï¼‰
- **IVF_SQ8**ï¼šå†…å­˜å ç”¨å°ï¼Œé€Ÿåº¦å¿«
- **HNSW**ï¼šæŸ¥è¯¢æœ€å¿«ï¼Œå†…å­˜å ç”¨å¤§ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

### è·ç¦»åº¦é‡
- **L2**ï¼šæ¬§æ°è·ç¦»ï¼ˆé»˜è®¤ï¼‰
- **IP**ï¼šå†…ç§¯ï¼ˆéœ€è¦å½’ä¸€åŒ–å‘é‡ï¼‰
- **COSINE**ï¼šä½™å¼¦ç›¸ä¼¼åº¦

### æ‰¹é‡æ“ä½œ
- å»ºè®®æ¯æ‰¹æ’å…¥ 1000-10000 æ¡æ•°æ®
- ä½¿ç”¨ `collection.flush()` ç¡®ä¿æ•°æ®æŒä¹…åŒ–

## ğŸ› æ•…éšœæ’æŸ¥

### Milvus è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨
docker-compose ps milvus

# æŸ¥çœ‹å¥åº·çŠ¶æ€
docker-compose exec milvus curl http://localhost:9091/healthz

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs milvus
```

### Attu æ— æ³•è¿æ¥
- ç¡®ä¿ Milvus å·²å®Œå…¨å¯åŠ¨
- å°è¯•ä½¿ç”¨ `localhost:19530` è€Œä¸æ˜¯ `milvus:19530`

### å†…å­˜ä¸è¶³
- Docker Desktop â†’ Settings â†’ Resources
- å»ºè®®åˆ†é…è‡³å°‘ 6GB å†…å­˜

## ğŸ“– æ›´å¤šèµ„æº

- [å¿«é€Ÿå¯åŠ¨æŒ‡å—](docs/QUICK_START.md)
- [å®Œæ•´éƒ¨ç½²æ–‡æ¡£](docs/MILVUS_SETUP.md)
- [Milvus å®˜æ–¹æ–‡æ¡£](https://milvus.io/docs)
- [PyMilvus API æ–‡æ¡£](https://milvus.io/api-reference/pymilvus/v2.3.x/About.md)
- [Attu ä½¿ç”¨æŒ‡å—](https://github.com/zilliz/attu)

## âœ¨ ç‰¹æ€§äº®ç‚¹

- âœ… **å¼€ç®±å³ç”¨**ï¼šä¸€æ¡å‘½ä»¤å¯åŠ¨æ‰€æœ‰æœåŠ¡
- âœ… **å¯è§†åŒ–ç®¡ç†**ï¼šAttu æä¾›ç›´è§‚çš„ Web ç•Œé¢
- âœ… **æ•°æ®æŒä¹…åŒ–**ï¼šè‡ªåŠ¨ä¿å­˜æ‰€æœ‰æ•°æ®
- âœ… **é«˜æ€§èƒ½**ï¼šæ¯«ç§’çº§å‘é‡æ£€ç´¢
- âœ… **æ˜“äºé›†æˆ**ï¼šç®€æ´çš„ Python API
- âœ… **ç”Ÿäº§å°±ç»ª**ï¼šæ”¯æŒå¤§è§„æ¨¡æ•°æ®å­˜å‚¨

---

ğŸŠ **éƒ¨ç½²å®Œæˆï¼ç°åœ¨ä½ å¯ä»¥å¼€å§‹ä½¿ç”¨ Milvus å‘é‡æ•°æ®åº“äº†ï¼**

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒæ–‡æ¡£æˆ–æŸ¥çœ‹ç¤ºä¾‹ä»£ç ã€‚

